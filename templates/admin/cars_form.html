{% extends "base.html" %}
{% block title %}{{ 'Edit' if car else 'Add' }} Car{% endblock %}
{% block content %}

<h1>{{ 'Edit' if car else 'Add' }} Car</h1>
<form method="post" enctype="multipart/form-data" class="car-form">
  <div class="grid-3">
    <input name="title" placeholder="Title" value="{{ car.title if car else '' }}" required>
    <input name="make" placeholder="Make" value="{{ car.make if car else '' }}">
    <input name="model" placeholder="Model" value="{{ car.model if car else '' }}">
  </div>
  <div class="grid-4">
    <input type="number" name="year" placeholder="Year" value="{{ car.year if car else '' }}">
    <input type="number" name="price" placeholder="Price" value="{{ car.price if car else '' }}">
    <input type="number" name="mileage_km" placeholder="Mileage (km)" value="{{ car.mileage_km if car else '' }}">
    <input name="color" placeholder="Color" value="{{ car.color if car else '' }}">
  </div>
  <div class="grid-4">
    <input name="fuel_type" placeholder="Fuel (Petrol/Diesel/Hybrid/Electric)"
      value="{{ car.fuel_type if car else '' }}">
    <input name="transmission" placeholder="Transmission" value="{{ car.transmission if car else '' }}">
    <input name="body_type" placeholder="Body Type" value="{{ car.body_type if car else '' }}">
    <input name="location" placeholder="Location" value="{{ car.location if car else '' }}">
  </div>
<label>Upload Images (max 5)</label>

<div class="grid-5" style="display:grid;grid-template-columns:repeat(5,minmax(80px,1fr));gap:10px;margin-bottom:10px;">
  <!-- Live preview slots -->
  {% for i in range(1,6) %}
    <div style="border:1px solid #333; padding:6px; border-radius:8px; text-align:center;">
      <img id="slot{{i}}" style="max-height:100px;display:none;" alt="preview {{i}}">
      <div style="margin-top:6px;font-size:12px;color:#999;" id="slot{{i}}_name"></div>
    </div>
  {% endfor %}
</div>

<!-- Five individual file inputs -->
<div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;">
  {% for i in range(1,6) %}
    <label class="btn">
      <input type="file" name="image_file{{i}}" id="image_file{{i}}" accept="image/*" style="display:none;">
      Upload {{i}}
    </label>
  {% endfor %}
</div>

{% if car %}
  <!-- Existing cover image preview (what dashboard uses) -->
  <div class="preview" style="margin:8px 0 14px;">
    <img
      id="cover_preview"
      src="{{ car.image_url or url_for('static', filename='img/placeholder.svg') }}"
      alt="Current cover image"
      style="max-height:120px"
    >
  </div>

  {% if car.images %}
    <!-- Existing gallery thumbnails -->
    <div class="gallery" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;">
      {% for img in car.images[:5] %}
        <img src="{{ img.url }}" alt="car image" style="max-height:90px;border:1px solid #333;border-radius:6px;">
      {% endfor %}
    </div>
  {% endif %}
{% endif %}

<script>
  // Live preview for each of the 5 inputs
  for (let i = 1; i <= 5; i++) {
    const input = document.getElementById('image_file' + i);
    const img   = document.getElementById('slot' + i);
    const label = document.getElementById('slot' + i + '_name');
    if (!input) continue;

    input.addEventListener('change', (e) => {
      const [file] = e.target.files || [];
      if (!file) {
        img.style.display = 'none';
        img.src = '';
        if (label) label.textContent = '';
        return;
      }
      img.src = URL.createObjectURL(file);
      img.style.display = 'inline-block';
      if (label) label.textContent = file.name;
      // also update the big cover preview if it's still placeholder
      const cover = document.getElementById('cover_preview');
      if (cover && (cover.src.includes('placeholder.svg') || !cover.src)) {
        cover.src = img.src;
      }
    });
  }
</script>



  <button>{{ 'Update' if car else 'Create' }}</button>
</form>

{% endblock %}