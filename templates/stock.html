{% extends "base.html" %}
{% block title %}Stock Cars{% endblock %}
{% block content %}
<h1>Stock Cars</h1>
<form class="filters" action="{{ url_for('stock') }}" method="get">
  <!-- existing fields ... -->
  <input name="q"        placeholder="Search..."      value="{{ request.args.get('q','') }}">
  <input name="make"     placeholder="Make"           value="{{ request.args.get('make','') }}">
  <input name="model"    placeholder="Model"          value="{{ request.args.get('model','') }}">
  <input name="min_year" placeholder="Min Year"       value="{{ request.args.get('min_year','') }}">
  <input name="max_year" placeholder="Max Year"       value="{{ request.args.get('max_year','') }}">
  <input name="min_price"placeholder="Min Price"      value="{{ request.args.get('min_price','') }}">
  <input name="max_price"placeholder="Max Price"      value="{{ request.args.get('max_price','') }}">

  <!-- ▼ NEW: Auction point dropdown -->
  <select name="auction">
    <option value="">Auction point</option>
    {% for g in ['R','2','3','3.5','4','4.5','5','S'] %}
      <option value="{{ g }}" {{ 'selected' if request.args.get('auction') == g else '' }}>{{ g }}</option>
    {% endfor %}
  </select>
  <!-- ▲ NEW -->

  <select name="fuel">
    <option value="">Fuel</option>
    {% for f in ['Petrol','Diesel','Hybrid','Electric'] %}
      <option value="{{ f }}" {{ 'selected' if request.args.get('fuel')==f else '' }}>{{ f }}</option>
    {% endfor %}
  </select>

  <select name="transmission">
    <option value="">Transmission</option>
    {% for t in ['Automatic','Manual','CVT'] %}
      <option value="{{ t }}" {{ 'selected' if request.args.get('transmission')==t else '' }}>{{ t }}</option>
    {% endfor %}
  </select>

  <select name="body_type">
    <option value="">Body Type</option>
    {% for b in ['Sedan','Hatchback','SUV','Wagon','Coupe','Van'] %}
      <option value="{{ b }}" {{ 'selected' if request.args.get('body_type')==b else '' }}>{{ b }}</option>
    {% endfor %}
  </select>

  <select name="sort">
    <option value="new"   {{ 'selected' if request.args.get('sort','new')=='new' else '' }}>Sort</option>
    <option value="price_asc"  {{ 'selected' if request.args.get('sort')=='price_asc' else '' }}>Price: Low → High</option>
    <option value="price_desc" {{ 'selected' if request.args.get('sort')=='price_desc' else '' }}>Price: High → Low</option>
  </select>

  <button>Apply</button>
</form>

<div class="cards">
{% for car in cars %}
  <a class="card" href="{{ url_for('car_detail', car_id=car.id) }}">
<img class="card-cover"
     src="{{ car.image_url or url_for('static', filename='img/placeholder.svg') }}"
     alt="{{ car.title }}"
     loading="lazy" decoding="async">


    <div class="card-body">
      <h3>{{ car.title }}</h3>
      <p class="price">৳ {{ "{:,}".format(car.price or 0) }}</p>
      <p class="muted small">{{ car.year }} • {{ car.mileage_km }} km • {{ car.fuel_type }} • {{ car.transmission }}</p>
    </div>
  </a>
{% else %}
  <p>No cars found.</p>
{% endfor %}
</div>

{% macro page_url(page_num) -%}
  {{ url_for('stock') }}?{% for k, v in params.items() if k != 'page' %}{{ k }}={{ v|urlencode }}&{% endfor %}page={{ page_num }}
{%- endmacro %}

{% if pagination.pages > 1 %}
<div class="pagination">
  {% if pagination.has_prev %}
    <a href="{{ page_url(pagination.prev_num) }}">&laquo; Prev</a>
  {% endif %}
  <span>Page {{ pagination.page }} of {{ pagination.pages }}</span>
  {% if pagination.has_next %}
    <a href="{{ page_url(pagination.next_num) }}">Next &raquo;</a>
  {% endif %}
</div>
{% endif %}

{% endblock %}
